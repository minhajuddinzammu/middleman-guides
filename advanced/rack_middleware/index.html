<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleman: Rack Middleware</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Source+Code+Pro">
    <link href="/stylesheets/site.css" rel="stylesheet" />
  </head>
  <body>
      <header id="header">
    <nav class="global-nav" role="navigation">
  <section class="wrap-container">
    <header class="global-nav-item logo-text">
      <a class="global-nav-middleman-signature" href="/">Middleman</a>
      <a class="global-nav-middleman-logo" href="/"><img src="/images/middleman-logo.svg" /></a>
    </header>

    <ul class="global-nav-list">
      <li class="global-nav-item">
        <a href="/community/">Contribute</a>
      </li>
      <li class="global-nav-item">
        <a class="cta-link-nav" href="/basics/install/">Docs</a>
      </li>
    </ul>
  </section>
</nav>

  </header>

  <div class="body-content-container wrap-container" role="main">
    <nav id="toc" class="sidebar" data-waypoint="sidebar">
      <div id="search" role="search">
  <form>
    <input class="st-search-input" id="st-search-input" type="search" placeholder="Search the docs">
  </form>
  <div id="st-results-container"></div>
  <script>
    var Swiftype = window.Swiftype || {};
    (function() {
    Swiftype.key = 'q3qjGN5LmX2oq6w1V47y';
    Swiftype.inputElement = '#st-search-input';
    Swiftype.resultContainingElement = '#st-results-container';
    Swiftype.attachElement = '#st-search-input';
    Swiftype.renderStyle = "overlay";

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.async = true;
    script.src = "//swiftype.com/embed.js";
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
    }());
  </script>
</div>

<div class="toc-block-container">
  <div class="toc-block">
    <h3 class="docs-section-heading">Basics</h3>
    <ul>
      <li class="doc-item">
        <a href="/basics/install/">Install</a> </li>
      <li class="doc-item">
        <a href="/basics/upgrade-v4/">Upgrading to v4</a> </li>
      <li class="doc-item">
        <a href="/basics/start_new_site/">Start a New Site</a>
      </li>
      <li class="doc-item">
        <a href="/basics/directory-structure/">Directory Structure</a>
      </li>
      <li class="doc-item" >
        <a href="/basics/development_cycle/">Development Cycle</a>
      </li>
      <li class="doc-item">
        <a href="/basics/build_and_deploy/">Build & Deploy</a>
        </li>
      <li class="doc-item">
        <a href="/basics/frontmatter/">Frontmatter</a>
        </li>
      <li class="doc-item">
        <a href="/basics/templating_language/">Templating Language</a>
        </li>
      <li class="doc-item">
        <a href="/basics/helper_methods/">Helper Methods</a>
        </li>
      <li class="doc-item">
        <a href="/basics/layouts/">Layouts</a>
        </li>
      <li class="doc-item">
        <a href="/basics/partials/">Partials</a>
        </li>
      <li class="doc-item">
        <a href="/basics/blogging/">Blogging</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Advanced</h3>
    <ul>
      <li class="doc-item">
        <a href="/advanced/configuration/">Configuring Your Site</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/project_templates/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/dynamic_pages/">Dynamic Pages</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/data_files/">Data Files</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/localization/">Localization (i18n)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/asset_pipeline/">Asset Pipeline</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/rack_middleware/">Rack Middleware</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/sitemap/">The Sitemap</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/pretty_urls/">Pretty URLs (Directory Indexes)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/improving_cacheability/">Improving Cacheability</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/file_size_optimization/">File Size Optimization</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/custom_extensions/">Custom Extensions</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Open-Source Community</h3>
    <ul>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/all/">Custom Extensions</a>
      </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/templates/all/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/deployment/">Deployment Solution</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://forum.middlemanapp.com/">Community Forum</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://github.com/middleman/middleman">GitHub Repository</a>
        </li>
      <li class="doc-item">
        <a href="/community/built_using_middleman/">Sites Built Using Middleman</a>
        </li>
    </ul>
  </div>
</div>

    </nav>

    <main class="main" role="main" data-waypoint="main">
      <h1 id="rack-middleware">Rack Middleware</h1>

<p>Rack is a system of classes that can modify content on-the-fly and intercept
requests before they are processed by the server (Middleman).</p>

<p>Middleman has full access to Rack Middleware which opens up an expansive
universe of libraries which work with Middleman.</p>

<h2 id="example-syntax-highlighting">Example: Syntax Highlighting</h2>

<p><strong>Note:</strong> The official
<a href="https://github.com/middleman/middleman-syntax">middleman-syntax</a> extension is
a better way to do syntax highlighting - what follows is just an example of how
to use Rack middleware.</p>

<p>This site is written in Middleman and features many code blocks which have
syntax highlighting. This syntax highlighting is accomplished outside the scope
of Middleman. This site renders <code>&lt;code&gt;</code> blocks and then Rack Middleware takes
over and enhances those blocks with syntax highlight. The middleware in use is
called <a href="https://github.com/wbzyl/rack-codehighlighter"><code>Rack::Codehighlighter</code></a>.
Here&#39;s how it can be used in your <code>config.rb</code>:</p>

<pre><code class="ruby">require &#39;rack/codehighlighter&#39;
require &quot;pygments&quot;
use Rack::Codehighlighter,
  :pygments,
  :element =&gt; &quot;pre&gt;code&quot;,
  :pattern =&gt; /\A:::([-_+\w]+)\s*\n/,
  :markdown =&gt; true
</code></pre>

<p>Make sure you add the right dependencies to your <code>Gemfile</code> to make those work:</p>

<pre><code class="ruby">gem &quot;rack-codehighlighter&quot;, :git =&gt; &quot;git://github.com/wbzyl/rack-codehighlighter.git&quot;
gem &quot;pygments.rb&quot;
</code></pre>

<p>The above block required the <code>rack/codehighlighter</code> and <code>pygments.rb</code>
libraries. Then the <code>use</code> command tells Middleman to use this middleware. The
rest is standard Rack Middleware setup, passing some variables to the
middleware itself instructing the syntax highlighter on how to locate code
blocks and which backend to use for parsing the syntax.</p>

<h2 id="build-cycle">Build Cycle</h2>

<p>The Rack Middleware is run on all requests, including those done during the
build cycle. This means anything the Rack Middleware effects during preview
will be present in the built files. However, be aware that once the project is
built, it is a static site. Rack Middleware which does processing on requests,
expecting things like cookies, sessions or variables, won&#39;t work once the site
is built.</p>

<h2 id="useful-middleware">Useful Middleware</h2>

<ul>
<li><a href="https://github.com/ambethia/rack-google_analytics">Rack::GoogleAnalytics</a></li>
<li><a href="https://github.com/rbialek/rack-tidy">Rack::Tidy</a></li>
<li><a href="https://gist.github.com/235715">Rack::Validate</a></li>
<li><a href="https://gist.github.com/235097">Rack::SpellCheck</a></li>
</ul>

    </main>
  </div>

    <footer class="footer" data-waypoint="footer" role="contentinfo">
  <div class="wrap-container">
    <div class="footer-column">
      <article class="footer-site-information">
        <p>
          &copy; 2011&ndash;2015 <a href="//awardwinningfjords.com">Thomas Reynolds</a>
        </p>
        <p class="footer-open-source-credit">
          Maintained by the <a href="//github.com/orgs/middleman/people">core team</a> with help from
            <a href="//github.com/middleman/middleman/graphs/contributors">contributors</a>.
        </p>
      </article>
      <article class="footer-contact">
        <ul class="footer-contact-list">
          <li class="footer-contact-list-item twitter-link">
            <a href="//twitter.com/middlemanapp">@middlemanapp</a>
          </li>
          <li class="footer-contact-list-item github-link">
            <a href="//github.com/middleman/middleman">GitHub</a>
          </li>
        </ul>
      </article>
    </div>
    <div class="footer-column footer-right">
      <a href="https://formkeep.com?utm_source=middleman">
        <span class="footer-formkeep-logo"></span>
      </a>
      <p class="footer-credit">
        FormKeep provides

        <a href="https://formkeep.com/?utm_source=middleman">form endpoints for Middleman sites</a>.
      </p>
    </div>
  </div>
</footer>

    <script src="/javascripts/site.js"></script>
    <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-90027-21']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
<script>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ef39d56613f5d017b000004');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
  </body>
</html>
