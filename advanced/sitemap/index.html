<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleman: The Sitemap</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Source+Code+Pro">
    <link href="/stylesheets/site.css" rel="stylesheet" />
  </head>
  <body>
      <header id="header">
    <nav class="global-nav" role="navigation">
  <section class="wrap-container">
    <header class="global-nav-item logo-text">
      <a class="global-nav-middleman-signature" href="/">Middleman</a>
      <a class="global-nav-middleman-logo" href="/"><img src="/images/middleman-logo.svg" /></a>
    </header>

    <ul class="global-nav-list">
      <li class="global-nav-item">
        <a href="/community/">Contribute</a>
      </li>
      <li class="global-nav-item">
        <a class="cta-link-nav" href="/basics/install/">Docs</a>
      </li>
    </ul>
  </section>
</nav>

  </header>

  <div class="body-content-container wrap-container" role="main">
    <nav id="toc" class="sidebar" data-waypoint="sidebar">
      <div id="search" role="search">
  <form>
    <input class="st-search-input" id="st-search-input" type="search" placeholder="Search the docs">
  </form>
  <div id="st-results-container"></div>
  <script>
    var Swiftype = window.Swiftype || {};
    (function() {
    Swiftype.key = 'q3qjGN5LmX2oq6w1V47y';
    Swiftype.inputElement = '#st-search-input';
    Swiftype.resultContainingElement = '#st-results-container';
    Swiftype.attachElement = '#st-search-input';
    Swiftype.renderStyle = "overlay";

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.async = true;
    script.src = "//swiftype.com/embed.js";
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
    }());
  </script>
</div>

<div class="toc-block-container">
  <div class="toc-block">
    <h3 class="docs-section-heading">Basics</h3>
    <ul>
      <li class="doc-item">
        <a href="/basics/install/">Install</a> </li>
      <li class="doc-item">
        <a href="/basics/upgrade-v4/">Upgrading to v4</a> </li>
      <li class="doc-item">
        <a href="/basics/start_new_site/">Start a New Site</a>
      </li>
      <li class="doc-item">
        <a href="/basics/directory-structure/">Directory Structure</a>
      </li>
      <li class="doc-item" >
        <a href="/basics/development_cycle/">Development Cycle</a>
      </li>
      <li class="doc-item">
        <a href="/basics/build_and_deploy/">Build & Deploy</a>
        </li>
      <li class="doc-item">
        <a href="/basics/frontmatter/">Frontmatter</a>
        </li>
      <li class="doc-item">
        <a href="/basics/templating_language/">Templating Language</a>
        </li>
      <li class="doc-item">
        <a href="/basics/helper_methods/">Helper Methods</a>
        </li>
      <li class="doc-item">
        <a href="/basics/layouts/">Layouts</a>
        </li>
      <li class="doc-item">
        <a href="/basics/partials/">Partials</a>
        </li>
      <li class="doc-item">
        <a href="/basics/blogging/">Blogging</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Advanced</h3>
    <ul>
      <li class="doc-item">
        <a href="/advanced/configuration/">Configuring Your Site</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/project_templates/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/dynamic_pages/">Dynamic Pages</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/data_files/">Data Files</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/localization/">Localization (i18n)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/asset_pipeline/">Asset Pipeline</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/rack_middleware/">Rack Middleware</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/sitemap/">The Sitemap</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/pretty_urls/">Pretty URLs (Directory Indexes)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/improving_cacheability/">Improving Cacheability</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/file_size_optimization/">File Size Optimization</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/custom_extensions/">Custom Extensions</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Open-Source Community</h3>
    <ul>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/all/">Custom Extensions</a>
      </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/templates/all/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/deployment/">Deployment Solution</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://forum.middlemanapp.com/">Community Forum</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://github.com/middleman/middleman">GitHub Repository</a>
        </li>
      <li class="doc-item">
        <a href="/community/built_using_middleman/">Sites Built Using Middleman</a>
        </li>
    </ul>
  </div>
</div>

    </nav>

    <main class="main" role="main" data-waypoint="main">
      <h1 id="the-sitemap">The Sitemap</h1>

<p>Middleman includes a Sitemap, accessible from templates, that can give you
information about all the pages and resources in your site and how they relate
to each other. This can be used to create navigation, build search pages and
feeds, etc.</p>

<p>The <a href="http://rubydoc.info/gems/middleman-core/Middleman/Sitemap">sitemap</a> is a
repository of every page in your site, including HTML, CSS, JavaScript, images
- everything. It also includes any <a href="/advanced/dynamic_pages/">dynamic pages</a> you&#39;ve created using
<code>:proxy</code>. </p>

<h2 id="seeing-the-sitemap">Seeing the Sitemap</h2>

<p>To understand exactly how Middleman sees your site, start the preview server
and load up <a href="http://localhost:4567/__middleman/sitemap/">http://localhost:4567/__middleman/sitemap/</a>. You&#39;ll be able to
browse the whole sitemap and see the source path, destination (build) path,
URL, and more for each resource in the sitemap. Pay special attention to the
&quot;path&quot;: you&#39;ll use that path to refer to files from <code>page</code>, <code>ignore</code> and
<code>proxy</code> in <code>config.rb</code>, and from <code>link_to</code> and <code>url_for</code> in your templates.</p>

<h2 id="accessing-the-sitemap-from-code">Accessing the Sitemap from Code</h2>

<p>Within templates <code>sitemap</code> gets you the sitemap object. From there, you can
look at every page via the
<a href="http://rubydoc.info/gems/middleman-core/Middleman/Sitemap/Store#resources-instance_method"><code>resources</code></a>
method or grab individual resources via
<a href="http://rubydoc.info/gems/middleman-core/Middleman/Sitemap/Store#find_resource_by_path-instance_method"><code>find_resource_by_path</code></a>.
You can also always get the page object for the page you&#39;re currently in via
<code>current_resource</code>. Once you&#39;ve got the list of pages from the sitemap, you can
filter on various properties using the individual page objects.</p>

<h2 id="sitemap-resources">Sitemap Resources</h2>

<p>Each resource in the sitemap is a
<a href="http://rubydoc.info/gems/middleman-core/Middleman/Sitemap/Resource">Resource</a>
object. Resources can tell you all kinds of interesting things about
themselves. You can access <a href="/basics/frontmatter/">frontmatter</a> data, file extension, source and
output paths, a linkable url, etc. Some of the properties of the Resource are
mostly useful for Middleman&#39;s rendering internals, but you could imagine
filtering pages on file extension to find all <code>.html</code> files, for example.</p>

<p>Each page can also find other pages related to it in the site hierarchy. The
<code>parent</code>, <code>siblings</code>, and <code>children</code> methods are particularly useful in
building navigation menus and breadcrumbs.</p>

<p>The sitemap can also be queried via an ActiveRecord-like syntax:</p>

<pre><code class="ruby">sitemap.where(:tags.include =&gt; &quot;homepage&quot;).order_by(:priority).limit(10)
</code></pre>

<p>See <a href="http://rubydoc.info/gems/middleman-core/Middleman/Sitemap/Queryable">Middleman::Sitemap::Queryable</a> for more on the query interface.</p>

<h2 id="using-the-sitemap-in-config-rb">Using the Sitemap in config.rb</h2>

<p>You can use the sitemap information to create new <a href="/advanced/dynamic_pages/">dynamic pages</a> from
<code>config.rb</code>, but you need to be a little careful, because the sitemap isn&#39;t
populated until <em>after</em> <code>config.rb</code> has already been run. To get around this,
you need to register a callback for the application&#39;s <code>ready</code> event. As an
example, let&#39;s say we&#39;ve added a &quot;category&quot; element to the <a href="/basics/frontmatter/">frontmatter</a> of our
pages, and we want to create category pages dynamically for each category. To
do that, we&#39;d add this to <code>config.rb</code>:</p>

<pre><code class="ruby">ready do
  sitemap.resources.group_by {|p| p.data[&quot;category&quot;] }.each do |category, pages|
    proxy &quot;/categories/#{category}.html&quot;, &quot;category.html&quot;, 
      :locals =&gt; { :category =&gt; category, :pages =&gt; pages }
  end
end
</code></pre>

<p>Then I could make a <code>category.html.erb</code> that uses the <code>category</code> and <code>pages</code>
variables to build a category listing for each category.</p>

    </main>
  </div>

    <footer class="footer" data-waypoint="footer" role="contentinfo">
  <div class="wrap-container">
    <div class="footer-column">
      <article class="footer-site-information">
        <p>
          &copy; 2011&ndash;2015 <a href="//awardwinningfjords.com">Thomas Reynolds</a>
        </p>
        <p class="footer-open-source-credit">
          Maintained by the <a href="//github.com/orgs/middleman/people">core team</a> with help from
            <a href="//github.com/middleman/middleman/graphs/contributors">contributors</a>.
        </p>
      </article>
      <article class="footer-contact">
        <ul class="footer-contact-list">
          <li class="footer-contact-list-item twitter-link">
            <a href="//twitter.com/middlemanapp">@middlemanapp</a>
          </li>
          <li class="footer-contact-list-item github-link">
            <a href="//github.com/middleman/middleman">GitHub</a>
          </li>
        </ul>
      </article>
    </div>
    <div class="footer-column footer-right">
      <a href="https://formkeep.com?utm_source=middleman">
        <span class="footer-formkeep-logo"></span>
      </a>
      <p class="footer-credit">
        FormKeep provides

        <a href="https://formkeep.com/?utm_source=middleman">form endpoints for Middleman sites</a>.
      </p>
    </div>
  </div>
</footer>

    <script src="/javascripts/site.js"></script>
    <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-90027-21']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
<script>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ef39d56613f5d017b000004');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
  </body>
</html>
