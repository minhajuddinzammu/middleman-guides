<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleman: File Size Optimization</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Source+Code+Pro">
    <link href="/stylesheets/site.css" rel="stylesheet" />
  </head>
  <body>
      <header id="header">
    <nav class="global-nav" role="navigation">
  <section class="wrap-container">
    <header class="global-nav-item logo-text">
      <a class="global-nav-middleman-signature" href="/">Middleman</a>
      <a class="global-nav-middleman-logo" href="/"><img src="/images/middleman-logo.svg" /></a>
    </header>

    <ul class="global-nav-list">
      <li class="global-nav-item">
        <a href="/community/">Contribute</a>
      </li>
      <li class="global-nav-item">
        <a class="cta-link-nav" href="/basics/install/">Docs</a>
      </li>
    </ul>
  </section>
</nav>

  </header>

  <div class="body-content-container wrap-container" role="main">
    <nav id="toc" class="sidebar" data-waypoint="sidebar">
      <div id="search" role="search">
  <form>
    <input class="st-search-input" id="st-search-input" type="search" placeholder="Search the docs">
  </form>
  <div id="st-results-container"></div>
  <script>
    var Swiftype = window.Swiftype || {};
    (function() {
    Swiftype.key = 'q3qjGN5LmX2oq6w1V47y';
    Swiftype.inputElement = '#st-search-input';
    Swiftype.resultContainingElement = '#st-results-container';
    Swiftype.attachElement = '#st-search-input';
    Swiftype.renderStyle = "overlay";

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.async = true;
    script.src = "//swiftype.com/embed.js";
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
    }());
  </script>
</div>

<div class="toc-block-container">
  <div class="toc-block">
    <h3 class="docs-section-heading">Basics</h3>
    <ul>
      <li class="doc-item">
        <a href="/basics/install/">Install</a> </li>
      <li class="doc-item">
        <a href="/basics/upgrade-v4/">Upgrading to v4</a> </li>
      <li class="doc-item">
        <a href="/basics/start_new_site/">Start a New Site</a>
      </li>
      <li class="doc-item">
        <a href="/basics/directory-structure/">Directory Structure</a>
      </li>
      <li class="doc-item" >
        <a href="/basics/development_cycle/">Development Cycle</a>
      </li>
      <li class="doc-item">
        <a href="/basics/build_and_deploy/">Build & Deploy</a>
        </li>
      <li class="doc-item">
        <a href="/basics/frontmatter/">Frontmatter</a>
        </li>
      <li class="doc-item">
        <a href="/basics/templating_language/">Templating Language</a>
        </li>
      <li class="doc-item">
        <a href="/basics/helper_methods/">Helper Methods</a>
        </li>
      <li class="doc-item">
        <a href="/basics/layouts/">Layouts</a>
        </li>
      <li class="doc-item">
        <a href="/basics/partials/">Partials</a>
        </li>
      <li class="doc-item">
        <a href="/basics/blogging/">Blogging</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Advanced</h3>
    <ul>
      <li class="doc-item">
        <a href="/advanced/configuration/">Configuring Your Site</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/project_templates/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/dynamic_pages/">Dynamic Pages</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/data_files/">Data Files</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/localization/">Localization (i18n)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/asset_pipeline/">Asset Pipeline</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/rack_middleware/">Rack Middleware</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/sitemap/">The Sitemap</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/pretty_urls/">Pretty URLs (Directory Indexes)</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/improving_cacheability/">Improving Cacheability</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/file_size_optimization/">File Size Optimization</a>
        </li>
      <li class="doc-item">
        <a href="/advanced/custom_extensions/">Custom Extensions</a>
        </li>
    </ul>
  </div>

  <div class="toc-block">
    <h3 class="docs-section-heading">Open-Source Community</h3>
    <ul>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/all/">Custom Extensions</a>
      </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/templates/all/">Project Templates</a>
        </li>
      <li class="doc-item">
        <a href="https://directory.middlemanapp.com/#/extensions/deployment/">Deployment Solution</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://forum.middlemanapp.com/">Community Forum</a>
        </li>
      <li class="doc-item">
        <a target="_blank" href="https://github.com/middleman/middleman">GitHub Repository</a>
        </li>
      <li class="doc-item">
        <a href="/community/built_using_middleman/">Sites Built Using Middleman</a>
        </li>
    </ul>
  </div>
</div>

    </nav>

    <main class="main" role="main" data-waypoint="main">
      <h1 id="file-size-optimization">File Size Optimization</h1>

<h2 id="compressing-css-and-javascript">Compressing CSS and JavaScript</h2>

<p>Middleman handles CSS minification and Javascript compression so you don&#39;t have
to worry about it. Most libraries ship minified and compressed versions of
their files for users to deploy, but these files are unreadable or editable.
Middleman allows you to keep the original, commented files in our project so
you can easily read them and edit them if needed. Then, when you build the
project, Middleman will handle all the optimization for you.</p>

<p>In your <code>config.rb</code>, activate the <code>minify_css</code> and <code>minify_javascript</code> features
during the build of your site.</p>

<pre><code class="ruby">configure :build do
  activate :minify_css
  activate :minify_javascript
end
</code></pre>

<p>If you are already using a compressed file that includes <code>.min</code> in its
filename, Middleman won&#39;t touch it. This can be good for libraries like jQuery
which are carefully compressed by their authors ahead of time.</p>

<p>You can customize how the JavaScript compressor works by setting the
<code>:js_compressor</code> option after activating the <code>:minify_javascript</code> extension in
<code>config.rb</code> to a custom instance of Uglifier. See <a href="https://github.com/lautis/uglifier">Uglifier&#39;s
docs</a> for details. </p>

<p>For example, you could
enable unsafe optimizations and mangle top-level variable names like this:</p>

<pre><code class="ruby">activate :minify_javascript
set :js_compressor, ::Uglifier.new(:mangle =&gt; {:toplevel =&gt; true}, :compress =&gt; {:unsafe =&gt; true})
</code></pre>

<p>If you have <code>asset_hash</code> activated, are building your site on multiple servers
during deploy to sit behind a load balancer, and are compressing Javascript,
ensure that mangling variables is disabled. If mangling is enabled, Uglifier
will create different compressed versions of the Javascript on each machine,
leading to different hashes in the filename and different references in each
version of the HTML. For example:</p>

<pre><code class="ruby">set :js_compressor, Uglifier.new(:mangle =&gt; false)
</code></pre>

<p>If you want to exclude any files from being minified, pass the <code>:ignore</code> option
when activating these extensions, and give it one or more globs, regexes, or
procs that identify the files to ignore. Likewise, you can pass an <code>:exts</code>
option to change which file extensions are renamed.</p>

<p>You can speed up your JavaScript minification (and CoffeeScript builds) by
including these gems in your <code>Gemfile</code>:</p>

<pre><code class="ruby">gem &#39;therubyracer&#39; # faster JS compiles
gem &#39;oj&#39; # faster JS compiles
</code></pre>

<h2 id="gzip-text-files">GZIP text files</h2>

<p>It&#39;s a good idea to <a href="https://developer.yahoo.com/performance/rules.html#gzip">serve compressed
files</a> to user agents
that can handle it. Many web servers have the ability to gzip files on the fly,
but that requires CPU work every time the file is served, and as a result most
servers don&#39;t perform the maximum compression. Middleman can produce gzipped
versions of your HTML, CSS, and JavaScript alongside your regular files, and
you can instruct your web server to serve those pre-gzipped files directly.
First, enable the <code>:gzip</code> extension:</p>

<pre><code class="ruby">activate :gzip
</code></pre>

<p>Then configure your server to serve those files. If you use Nginx, check out
<a href="http://wiki.nginx.org/NginxHttpGzipStaticModule">the gzip_static</a> module. For
Apache, you&#39;ll have to do something a little trickier - see <a href="https://gist.github.com/2200790">this
Gist</a> for an example.</p>

<h2 id="compressing-images">Compressing Images</h2>

<p>If you also want to compress images on build, try
<a href="https://github.com/plasticine/middleman-imageoptim"><code>middleman-imageoptim</code></a>.</p>

<h2 id="minify-html">Minify HTML</h2>

<p>Middleman provides an official extension for minifying its HTML output. Simply
install the gem:</p>

<pre><code class="bash">gem install middleman-minify-html
</code></pre>

<p>Add <code>middleman-minify-html</code> to your <code>Gemfile</code>: </p>

<pre><code class="ruby">gem &quot;middleman-minify-html&quot;
</code></pre>

<p>Then open your <code>config.rb</code> and add:</p>

<pre><code class="ruby">activate :minify_html
</code></pre>

<p>You should notice whilst view-source:&#39;ing that your HTML is now being minified.</p>

<h2 id="using-source-sets">Using source sets</h2>

<p>One of the more recent additions to HTML is the <code>srcset</code> attribute for the <code>img</code> or <code>picture</code> tag. It allows you to define for the browser to load different images with different sizes dependent on either the viewport (using width such as <code>1024w, 800w, 600w, or 320w</code>) or the resolution of the current browser display (using factors <code>1x, 2x, 3x, ...</code>). </p>

<pre><code class="html">&lt;img src=&quot;img/100px.jpg&quot; srcset=&quot;img/300px.jpg 3x, img/200px.jpg 2x, img/100px.jpg 1x&quot;&gt;
&lt;img src=&quot;img/100px.jpg&quot; srcset=&quot;img/300px.jpg 300w, img/200px.jpg 200w, img/100px.jpg 100w&quot;&gt;

</code></pre>

<p>If you want to use <code>srcset</code> in conjunction with the <code>:asset_hash</code> option, you need to employ the <code>image_path</code> helper, which is described <a href="/advanced/asset_pipeline/">in this middleman section</a>:</p>

<pre><code class="html">&lt;img src=&quot;&lt;%= image_path(&#39;100px.jpg&#39;) %&gt;&quot; srcset=&quot;&lt;%= image_path(&#39;300px.jpg&#39;) %&gt; 3x, &lt;%= image_path(&#39;200px.jpg&#39;) %&gt; 2x, &lt;%= image_path(&#39;100px.jpg&#39;) %&gt; 1x&quot;&gt;
</code></pre>

<p>The <code>srcset</code> attribute is not yet supported by all browsers as you can see at <a href="http://caniuse.com/#feat=srcset">caniuse.com</a>. If it is not supported the browser uses the <code>src</code> attribute as fallback. We noted, that some browsers use the first entry of the <code>srcset</code> as fallback. This is why we have put the largest image first in our example.</p>

    </main>
  </div>

    <footer class="footer" data-waypoint="footer" role="contentinfo">
  <div class="wrap-container">
    <div class="footer-column">
      <article class="footer-site-information">
        <p>
          &copy; 2011&ndash;2015 <a href="//awardwinningfjords.com">Thomas Reynolds</a>
        </p>
        <p class="footer-open-source-credit">
          Maintained by the <a href="//github.com/orgs/middleman/people">core team</a> with help from
            <a href="//github.com/middleman/middleman/graphs/contributors">contributors</a>.
        </p>
      </article>
      <article class="footer-contact">
        <ul class="footer-contact-list">
          <li class="footer-contact-list-item twitter-link">
            <a href="//twitter.com/middlemanapp">@middlemanapp</a>
          </li>
          <li class="footer-contact-list-item github-link">
            <a href="//github.com/middleman/middleman">GitHub</a>
          </li>
        </ul>
      </article>
    </div>
    <div class="footer-column footer-right">
      <a href="https://formkeep.com?utm_source=middleman">
        <span class="footer-formkeep-logo"></span>
      </a>
      <p class="footer-credit">
        FormKeep provides

        <a href="https://formkeep.com/?utm_source=middleman">form endpoints for Middleman sites</a>.
      </p>
    </div>
  </div>
</footer>

    <script src="/javascripts/site.js"></script>
    <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-90027-21']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
<script>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ef39d56613f5d017b000004');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
  </body>
</html>
